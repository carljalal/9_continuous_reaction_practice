<html>
<body>
<script>
// multiplication is an "and" deviation from 1



// elements
html_instructions = document.createElement("div");
html_query = document.createElement("textarea");
html_indicator = document.createElement("div");
html_statistics = document.createElement("p");
// append
document.body.append(html_indicator);
document.body.append(html_instructions);
document.body.append(html_statistics);
document.body.append(html_query);
// initialize elements
html_instructions.innerHTML = "press any button to start";
html_instructions.style.fontFamily = "Verdana";
html_statistics.innerHTML = "no statistics at this time!";
html_query.rows = 2;
html_query.cols = 100
html_indicator.style.width = 300;
html_indicator.style.height = 300;
html_indicator.style.backgroundColor = "black";




// initialize game state variables
game_on = false;
waiting = false;
timeoutId = {};
numberSuccess = 0;
startTime = 0.0;
elapsedTime = 0.0;
lastTimeBecameGreen = 0.0;
reactionSpeedHistory = [];
numErrors = 0;





// switch color
redWaiting = () => {
    
    waiting = true;
    timeoutId = setTimeout(greenReady, Math.random()*1000 + Math.random() * Math.random() * Math.random() * Math.random() * Math.random() * 30000 + 10);
    html_indicator.style.backgroundColor = "red";
    
}
greenReady = () => {
    waiting = false;
    lastTimeBecameGreen = performance.now();
    html_indicator.style.backgroundColor = "lime";
    
}


// game end
quitGame = () => {
    clearTimeout(timeoutId);
    game_on = false;
    waiting = false;
    html_instructions.innerHTML = "press any button to start";
    html_indicator.style.backgroundColor = "black";
    numberSuccess = 0;
    timeElapsed = 0.0;
    lastTimeBecameGreen = 0.0;
    reactionSpeedHistory = [];
    numErrors = 0;
}

// game start
initializeGame = () => {
    game_on = true;
    startTime = performance.now();
    html_instructions.innerHTML = "red light wait, green light click";
    html_statistics.innerHTML = "no statistics yet";
    redWaiting();
}

getAverage = (list) => {
    sum = 0.0;
    list.forEach((x) => {
        sum += x;
    })
    return sum / list.length;
}


// handle input
clickHandler = (event) => {
        if(game_on == false) {
            initializeGame();
        }
        else {
            if (waiting == false) {
                timeElapsed = performance.now() - startTime;
                currentReactionSpeed = performance.now() - lastTimeBecameGreen;
                reactionSpeedHistory.push(currentReactionSpeed);
                html_statistics.innerHTML = "last reaction speed: "+ currentReactionSpeed
                html_statistics.innerHTML += "<br>number of tests: " + reactionSpeedHistory.length + " average reaction speed: " + getAverage(reactionSpeedHistory)/1000.0;
                html_statistics.innerHTML += "<br>number of errors: " + numErrors;
                html_statistics.innerHTML += "<br>session time: " + timeElapsed;
                redWaiting();
            }
            else if (waiting == true) {
                numErrors++;
            }
        }
    }

keyHandler = (event) => {    
        // quit game
        if(event.key = "q"){
            quitGame();
        }
    
}






// routing input
document.addEventListener("click",clickHandler);
document.addEventListener("keydown",keyHandler);



</script>
</body>
</html>